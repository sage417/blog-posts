---
title: '[项目] 多角色权限展示数据的一种实现'
date: '2019-07-29 10:00:00'
thumbnail: 'https://i.loli.net/2019/11/21/rK1i4uDs6WEzLc7.jpg'
tags:
    - 工作
    - java
    - 代码
categories:
    - 工作
    - 挑战
---

#### 多角色权限如果遇到不同角色能看到不同的列可以怎么做

- 逐行读取

最简单的解决方法，实现简单。但是在微服务中调用接口次数太多，性能很差。

- 批量读取

实现较复杂，但是性能好很多，下面主要介绍这种方法的思路



#### 批量读取

以分页读取数据为例：

1. 读取第一页数据，包含需要展示数据的id和所属权限（多个）

为什么需要所属权限这个字段呢？ 因为决定能否看到这行是有你所拥有的所有权限决定的，而决定能否看到哪个列是由这行所拥有的权限决定的。

如何获取该行所拥有的权限呢，我的做法是分不同的权限查询结果通过union 组合起来

2. 将第一页数据原始顺序保存， 然后按行拥有权限分组

记录原始顺序是因为后面分组后会打乱， 为什么要分组？分组后同样的查询才能聚合在一起，可以简化代码

3. 根据权限分组多次查询所需要的字段，然后将查询结果合并

这里我使用的graphql来选择需要查询的字段

4. 最后还原成原来的顺序

可以使用guava Ordering工具类方便生成Compartor





[]: https://blog.yamato.moe/2018/11/06/2018-11-06-biz/	"根据权限查询时避免角色切换的一种思路"
[]: https://blog.yamato.moe/2019/04/04/Mybatis%20ResultSetHandler_2019-04-04%20%E7%BB%AD/	"【片段】 Mybatis ResultSetHandler 实践-续"
[]: https://blog.yamato.moe/2019/01/09/Mybatis%20ResultSetHandler_2019-01-09/	"【片段】 Mybatis ResultSetHandler 实践"