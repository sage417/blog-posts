---
title: '《重构-改善既有代码设计》读书笔记'
date: '2018-09-08 10:00:00'
tags:
    - 读书
categories:
    - 读书
---

### 1.1 一个简单的例子

一个计算顾客租赁影片费用的程序，能容易写成面条式的代码（流水账）：顾客类调用影片类和租赁时长计算费用

对机器来言只要能运行正确没有好代码和坏代码之分，但是对（维护的）人来说很难找到修改点，容易引入bug



### 1.2重构前先写测试保证重构结果

利用单元测试保证重构正确性



### 1.3以微小的步伐修改程序，保证问题快速发现解决

不要为修改变量名感到羞耻，只有写出人能理解的代码才是好程序员

重构完可能 性能变差，但同时会带来更多的机会来优化



### 1.4干货－用多态代替switch

switch需要关心具体条件，多态具有switch不具备的优势：不需要关心具体类型



### 2.1重构的定义 

重构：不改变运行结果下 提高理解性 降低修改成本



### 2.2重构的原因

- 代码结构的流失是累积性的，越难看懂代码设计意图，越难保护其设计

- 消除重复代码，方便修改

- 我们编写代码时很容易忘记读者的感受，造成他人时间的浪费

- 重构时犯错可以加深对代码意图的理解，可以帮助发现bug

- 好的结构设计是加速开发的根本

  

### 2.3重构的时机

- 添加功能时重构，在修改过程中把结构理清，也可以更简单的添加功能

- 修复错误时重构 

- 复审代码时重构

  

### 2.4 重构的价值

程序有两面价值，今天可以为你做什么和明天可以为你做什么为了满足明天的需要，你会遇到：

- 难以阅读，逻辑重复
- 添加新功能许修改以前代码
- 复杂的条件逻辑等代码

而你希望看到的是：

- 容易阅读，所有逻辑在唯一指定地点，
- 新的修改不会危及现有行为
- 尽可能简单表达逻辑条件

**重构**就是把程序转变为这些特征的工具

### 2.5如何告诉（对付）经理

很多经理都是进度驱动，所以更加需要重构带来的好处，所以不要告诉他们 他们不会理解的

#### 2.5.1引入间接层与重构的关系

间接层优点：

- 允许逻辑共享

- 增加解释意图和实现的机会－多了类名和函数名

- 隔离变化

- 多态封装条件逻辑


#### 2.5.2何时不应该重构

- 软件根本不工作
- 最后期限已近

未完成的重构可以称之为债务，迟早要还

#### 2.5.3重构与预先设计的关系

重构可以节约不必要的时间精力花在预先设计上，让软件设计向简化发展



### 3代码的坏味道

- 重复代码
- 过长函数
- 过大类，过长参数

- 修改一处程序的原因过多/一个原因修改过多的程序

- 数据依赖过多

- 重复的字段和参数

- 总是放在一起的字段

- switch语句

- 平行继承关系

- 不是所有分支下都需要的临时变量

- 过度耦合调用链

- 不必要的委托

- 失血数据类

- 频繁重写父类方法

- 过多注释

### 4~12具体如何做

自己看书吧